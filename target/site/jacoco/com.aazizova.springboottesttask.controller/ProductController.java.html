<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProductController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">spring-boot-test-task</a> &gt; <a href="index.source.html" class="el_package">com.aazizova.springboottesttask.controller</a> &gt; <span class="el_source">ProductController.java</span></div><h1>ProductController.java</h1><pre class="source lang-java linenums">package com.aazizova.springboottesttask.controller;

import com.aazizova.springboottesttask.model.entity.Product;
import com.aazizova.springboottesttask.service.ProductService;
import com.aazizova.springboottesttask.utils.ProductUtils;
import com.aazizova.springboottesttask.utils.builder.CustomEntityBuilder;
import com.google.code.siren4j.component.Entity;
import com.google.code.siren4j.converter.ReflectingConverter;
import com.google.code.siren4j.error.Siren4JException;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiResponse;
import io.swagger.annotations.ApiResponses;
import lombok.extern.log4j.Log4j2;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.security.access.annotation.Secured;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletRequest;
import java.util.List;

@RestController
@RequestMapping(&quot;/api/products&quot;)
<span class="fc" id="L25">@Log4j2</span>
//@CrossOrigin(origins = &quot;http://localhost:3000&quot;)
@Api(value=&quot;Simple Inventory System&quot;, description=&quot;Operations pertaining to products in Simple Inventory System&quot;)
<span class="fc" id="L28">public class ProductController {</span>

    @Autowired
    ProductService productService;

    @Autowired
    ProductUtils productUtils;

    @Autowired
    CustomEntityBuilder customEntityBuilder;

    @ApiOperation(value = &quot;View all products&quot;, response = Entity.class)
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = &quot;Successfully retrieved products&quot;),
            @ApiResponse(code = 204, message = &quot;There are no products&quot;),
            @ApiResponse(code = 401, message = &quot;You are not authorized to view the resource&quot;),
            @ApiResponse(code = 403, message = &quot;Accessing the resource you were trying to reach is forbidden&quot;)
    })
    @GetMapping
    @Secured({&quot;ROLE_ADMIN&quot;, &quot;ROLE_USER&quot;})
    public Entity getProducts(HttpServletRequest request) throws Siren4JException {
<span class="fc" id="L49">        log.info(&quot;Getting products&quot;);</span>
<span class="fc" id="L50">        List&lt;Product&gt; products = productService.retrieveProducts();</span>
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">        if (products.isEmpty()) {</span>
<span class="nc" id="L52">            log.info(&quot;There are no products&quot;);</span>
<span class="nc" id="L53">            return customEntityBuilder.buildErrorEntity(HttpStatus.NO_CONTENT, &quot;There are no products&quot;);</span>
        }
<span class="fc" id="L55">        return customEntityBuilder.buildProductsEntity(products, request, &quot;products&quot;);</span>
    }

    @GetMapping(&quot;/{productId}&quot;)
    @Secured({&quot;ROLE_ADMIN&quot;, &quot;ROLE_USER&quot;})
    public Entity getProduct(@PathVariable(name = &quot;productId&quot;) Long productId) throws Siren4JException {//TODO add exception handling
<span class="nc" id="L61">        log.info(&quot;Getting Product with id = [&quot; + productId + &quot;]&quot;);</span>
<span class="nc" id="L62">        Product product = productService.getProductById(productId);</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">        if (product == null) {</span>
<span class="nc" id="L64">            log.info(&quot;Product with id = [&quot; + productId + &quot;] not found&quot;);</span>
<span class="nc" id="L65">            return customEntityBuilder.buildErrorEntity(HttpStatus.NOT_FOUND, &quot;Product with id = [&quot; + productId + &quot;] not found&quot;);</span>
        }
<span class="nc" id="L67">        return ReflectingConverter.newInstance().toEntity(product);</span>
    }

    @PostMapping(&quot;/&quot;)
    @Secured(&quot;ROLE_ADMIN&quot;)
    public Entity addProduct(@RequestBody Product product) throws Siren4JException {
<span class="nc" id="L73">        log.info(&quot;Saving Product = [&quot; + product + &quot;]&quot;);</span>
<span class="nc" id="L74">        productService.addProduct(product);</span>
<span class="nc" id="L75">        return ReflectingConverter.newInstance().toEntity(product);</span>
    }

    @DeleteMapping(&quot;/{productId}&quot;)
    @Secured(&quot;ROLE_ADMIN&quot;)
    public Entity deleteProduct(@PathVariable(name = &quot;productId&quot;) Long productId) {
<span class="nc" id="L81">        log.info(&quot;Deleting Product with id = [&quot; + productId + &quot;]&quot;);</span>
<span class="nc" id="L82">        Product product = productService.getProductById(productId);</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (product == null) {</span>
<span class="nc" id="L84">            log.info(&quot;Unable to delete product with id = [&quot; + productId + &quot;] because it's not found&quot;);</span>
<span class="nc" id="L85">            return customEntityBuilder.buildErrorEntity(HttpStatus.NOT_FOUND, &quot;Unable to delete product with id = [&quot; + productId + &quot;] because it's not found&quot;);</span>
        }
<span class="nc" id="L87">        productService.deleteProductById(productId);</span>
<span class="nc" id="L88">        return customEntityBuilder.buildSuccessEntity();</span>
    }

    @PutMapping(&quot;/{productId}&quot;)
    @Secured(&quot;ROLE_ADMIN&quot;)
    public Entity updateProduct(@RequestBody Product product,
                                @PathVariable(name = &quot;productId&quot;) Long productId) {
<span class="nc" id="L95">        log.info(&quot;Updating Product =[&quot; + product + &quot;]&quot;);</span>
<span class="nc" id="L96">        Product prod = productService.getProductById(productId);</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (prod == null) {</span>
<span class="nc" id="L98">            log.info(&quot;Product with id = [&quot; + productId + &quot;] not found&quot;);</span>
<span class="nc" id="L99">            return customEntityBuilder.buildErrorEntity(HttpStatus.NOT_FOUND, &quot;Product with id = [&quot; + productId + &quot;] not found&quot;);</span>
        }
<span class="nc" id="L101">        productService.updateProduct(product);</span>
<span class="nc" id="L102">        return customEntityBuilder.buildSuccessEntity();</span>
    }

    @PostMapping(&quot;/export&quot;)
    @Secured({&quot;ROLE_ADMIN&quot;, &quot;ROLE_USER&quot;})
    public Entity exportProducts(@RequestBody List&lt;Product&gt; products) {
<span class="nc" id="L108">        log.info(&quot;products = [&quot; + products + &quot;]&quot;);</span>
<span class="nc" id="L109">        log.info(&quot;Exporting filtered products&quot;);</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (!productUtils.exportToXLS(products)) {</span>
<span class="nc" id="L111">            log.info(&quot;Can't export&quot;);</span>
<span class="nc" id="L112">            return customEntityBuilder.buildErrorEntity(HttpStatus.NO_CONTENT, &quot;Can't export&quot;);</span>
        }
<span class="nc" id="L114">        return customEntityBuilder.buildSuccessEntity();</span>
    }

    @GetMapping(&quot;/leftovers&quot;)
    @Secured({&quot;ROLE_ADMIN&quot;, &quot;ROLE_USER&quot;})
    public Entity getLeftovers(HttpServletRequest request) {
<span class="nc" id="L120">        log.info(&quot;Getting leftovers&quot;);</span>
<span class="nc" id="L121">        List&lt;Product&gt; leftovers = productService.retrieveLeftovers();</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if (leftovers.isEmpty()) {</span>
<span class="nc" id="L123">            log.info(&quot;There are no leftovers&quot;);</span>
<span class="nc" id="L124">            return customEntityBuilder.buildErrorEntity(HttpStatus.NO_CONTENT, &quot;There are no leftovers&quot;);</span>
        }
<span class="nc" id="L126">        return customEntityBuilder.buildProductsEntity(leftovers, request, &quot;leftovers&quot;);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>